import requests
import json
import time
from datetime import datetime

# å°†ä» manifest ä¸­è·å–åˆ°çš„ API å¯†é’¥æ”¾åœ¨è¿™é‡Œ
API_KEYS = {
    "baidu_lbs": "UEnH61ElxrwvKKBOA6oTgio7",
    "coloros_camera": "ATBEAiBlu2AMxWd3cbaDkGXBlGP9ojLOanK26swRCrx8kOhedQIgMrU1ySPRc8VudROsZzGCX+9FdGHFzKsxNK7wTXs7EQ5xU+ypfAAAAA==",
    "coloros_olk": "ATBGAiEA13a94ZZ+9ScjSIFyINJKOZzMH+dxxYwvFEsXG6/C1EYCIQDsk3VJQw1yuumBy8MmpVDIij7kqiQK3KEKU5DUE+BaGm3GSt38AAAA",
    "coloros_hyper": "ATBEAiBJNHhwZ0FWIadgsHfFx1oB0BXsLZ9mxrmQc4L/hbAgWwIgPWNKxfYUT/5mFlXVTnn4RAEzHqaPX6Y1fTS1PeG4fQdokG/xYAAAAA==",
    "oplus_card": "ADBFAiEA7tcO65jxF48sKrZjVHgP1bNOxAvgTvpUt2wdpw33o5ACIEbYd9Jb/3VxPPTRDipl3uXbNpjmi0ysYP59kCcgA0J/bwme5Q==;ADBGAiEA3DQoBUXLi7Jgj9EkSzrDVZis1ipVO9hmPha0hPmnqOkCIQDRM07z+/ef/fk9ZC2X0d9NdN9YRiGfTrNBS5PunUUsqm8Jns0=",
    "vivo_push": "a71e4cd2-3308-4f30-8cde-652d6ec3d7ce",
    "amap_api": "d23a42abfdc38341aae4ad05e14a6aaa",
    "tencent_map": "OLABZ-KGH35-CXVIJ-QSCSU-M5P6T-QJFSI",
}

# æ›¿æ¢ä¸ºå®é™…çš„ API URL
API_ENDPOINTS = {
    "baidu_lbs": "https://api.map.baidu.com/location/v2",  # ç¤ºä¾‹ URLï¼Œæ›¿æ¢ä¸ºå®é™… URL
    "coloros_camera": "https://api.coloros.com/camera/v1",  # æ›¿æ¢ä¸ºå®é™… URL
    "coloros_olk": "https://api.coloros.com/olk/v1",  # æ›¿æ¢ä¸ºå®é™… URL
    "coloros_hyper": "https://api.coloros.com/hyper/v1",  # æ›¿æ¢ä¸ºå®é™… URL
    "oplus_card": "https://api.oplus.com/card/v1",  # æ›¿æ¢ä¸ºå®é™… URL
    "vivo_push": "https://push.vivo.com/api/v1/notify",  # æ›¿æ¢ä¸ºå®é™… URL
    "amap_api": "https://restapi.amap.com/v3/place",  # æ›¿æ¢ä¸ºå®é™… URL
    "tencent_map": "https://apis.map.qq.com/v2/geocoder",  # æ›¿æ¢ä¸ºå®é™… URL
}


def test_api_vulnerabilities(api_name, api_key, endpoint):
    print("\n" + "=" * 80)  # æ¼‚äº®çš„åˆ†éš”çº¿
    print(f"ğŸ¯ æ¥å£åç§°: {api_name}")
    print(f"ğŸ”— æ¥å£åœ°å€: {endpoint}")
    print(f"ğŸ”‘ APIå¯†é’¥: {api_key}")

    start_time = time.time()

    try:
        # å‘é€è¯·æ±‚å¹¶è®°å½•æ—¶é—´
        response = requests.get(endpoint, params={"key": api_key})
        elapsed_time = time.time() - start_time

        # åˆ¤æ–­å“åº”ç±»å‹
        content_type = response.headers.get("content-type", "")
        if "application/json" in content_type:
            data_type = "JSON"
            try:
                content = json.dumps(response.json(), indent=2, ensure_ascii=False)
            except:
                content = response.text
        elif "text/html" in content_type:
            data_type = "HTML"
            content = response.text
        else:
            data_type = content_type.split(";")[0]
            content = response.text

        # è·å–å“åº”å¤´ä¿¡æ¯
        headers = "\n".join([f"{k}: {v}" for k, v in response.headers.items()])

        # è¾“å‡ºè¯·æ±‚ä¿¡æ¯
        status_color = "ğŸŸ¢" if response.status_code < 400 else "ğŸ”´"
        print(f"\n{status_color} çŠ¶æ€ä¿¡æ¯:")
        print(f"â”œâ”€â”€ è¯·æ±‚æ–¹æ³•: GET")
        print(f"â”œâ”€â”€ çŠ¶æ€ä»£ç : {response.status_code}")
        print(f"â”œâ”€â”€ å“åº”ç±»å‹: {data_type}")
        print(f"â”œâ”€â”€ å“åº”å¤§å°: {len(response.content)} å­—èŠ‚")
        print(f"â””â”€â”€ å“åº”æ—¶é—´: {elapsed_time:.2f} ç§’")

        # å¦‚æœæ˜¯GETè¯·æ±‚ï¼Œæä¾›å¯ç‚¹å‡»çš„URL
        if "key" in response.url:
            safe_url = response.url.split("key=")[0] + "key=***"
            print(f"\nğŸ” æµ‹è¯•é“¾æ¥ (å·²éšè—å¯†é’¥):")
            print(f"â””â”€â”€ {safe_url}")
        else:
            print(f"\nğŸ” å®Œæ•´è¯·æ±‚åœ°å€:")
            print(f"â””â”€â”€ {response.url}")

        print("\nğŸ“‹ å“åº”å¤´ä¿¡æ¯:")
        print("-" * 40)
        print(headers)

        print("\nğŸ“„ å“åº”å†…å®¹:")
        print("-" * 40)
        print(content)
        print("-" * 40)

    except requests.exceptions.RequestException as e:
        print(f"\nâŒ é”™è¯¯ä¿¡æ¯: {str(e)}")
        print("-" * 40)


def main():
    # éå†æ¯ä¸ª APIï¼Œå¹¶æµ‹è¯•å…¶æ¼æ´
    for api_name, api_key in API_KEYS.items():
        endpoint = API_ENDPOINTS.get(api_name)
        if endpoint:
            test_api_vulnerabilities(api_name, api_key, endpoint)


if __name__ == "__main__":
    main()
